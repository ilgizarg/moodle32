define(["jquery","core/log","core/templates","theme_snap/pm_course_cards_hidden","theme_snap/pm_course_favorites","theme_snap/model_view","theme_snap/ajax_notification","theme_snap/util"],function(a,b,c,d,e,f,g,h){var i=function(){var i=this;this.applyCourseInfo=function(d){c.render("theme_snap/course_cards",[]).done(function(){for(var c in d){var e=d[c];b.debug("applying course data for courseid "+e.course);var g=a('.courseinfo[data-courseid="'+e.course+'"]');f(g,"theme_snap/course_cards"),a(g).trigger("modelUpdate",e)}})},this.reqCourseInfo=function(c){if(0!==c.length){var d="courseids="+c.join(","),e=M.cfg.sesskey+"courseinfo";b.debug("fetching course data"),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_courseinfo&contextid="+M.cfg.context,data:d,success:function(a){g.ifErrorShowBestMsg(a)||(a.info?(b.debug("fetched coursedata",a.info),h.supportsSessionStorage()&&(window.sessionStorage[e]=JSON.stringify(a.info)),i.applyCourseInfo(a.info)):b.warn("fetched coursedata with error: JSON data object is missing info property",a))}})}},this.getCourseIds=function(){var b=[];return a(".courseinfo").each(function(){b.push(a(this).attr("data-courseid"))}),b},this.init=function(){a(document).ready(function(){e(d);var a=i.getCourseIds(),b=M.cfg.sesskey+"courseinfo";if(a.length>0)if(h.supportsSessionStorage()&&window.sessionStorage[b]){var c=JSON.parse(window.sessionStorage[b]);i.applyCourseInfo(c)}else i.reqCourseInfo(a)}),a("#fixy-my-courses").on("click hover",".courseinfo-teachers-more",null,function(b){b.preventDefault();var c=a(this).html();c.indexOf("+")>-1?a(this).html(c.replace("+","-")):a(this).html(c.replace("-","+")),a(this).parents(".courseinfo").toggleClass("show-all")}),a(document).on("click",".courseinfo[data-href]",function(b){var c=a(b.target),d="_self";a(c).closest("a").length||(window.open(a(this).data("href"),d),b.preventDefault())})}};return new i});